# UUID

## UUID란?

* UUID(Universally unique identifier)란 정보 식별을 위한 범용 고유 식별자.

* 네트워크상에 존재하는 여러 컴퓨터 식별하기 위해 사용 시작.

## UUID 구조

* 128bit 숫자로 이루어지며, 36개 문자 (8개문자-4개문자-4개문자-4개문자-12개문자, 32개문자/4개하이픈) 로 이루어짐. 

* 하이픈은 UUID 값 읽기 편하게 추가한 구분자이므로 하이픈 생략하는 경우도 있음

* UUID 값 저장 시에는 하이픈 제외한 16진수만 저장

* 고유성을 완벽하게 보장할 순 없어도 실제 사용하면서 중복될 가능성 거의 없음

    * 동시에 여러 서버가 동일한 식별자 만드는 경우 etcd 나 Redis 같은 서비스로 가장 먼저 식별자 등록한 서버만 사용할 수 있게 할 수 있음

* 많은 식별자가 필요하지 않을 경우 일부 값만 랜덥하게 생성하고 나머지는 고정된 값 사용하는 경우 많음

## UUID 버전

* 버전에 따라 사용 방법과 생성되는 규칙이 다름

### **버전 1과 버전 2**

* 초창기 버전의 UUID로 네트워크에 있는 고유한 컴퓨터들 식별을 위해 사용됨

* 마이크로 서비스 아키텍처는 맥 주소가 달라도 같은 서버로 인식해야 하고, 도커와 같은 가상 서버는 같은 맥 주소를 가진 여러 서버를 동시에 생성할 수 있으므로 맥 주소와 타임스탬프 값으로 서버 식별하는 버전 1과 2는 더이상 사용되지 않음

* 버전 1 : 시간 + MAC주소

    * 컴퓨터의 맥 주소와 타임스탬프 값을 기반으로 UUID 생성

* 버전 2 : 시간 + DCE보안

    * 규모가 큰 시스템 환경을 고려해 자릿수 일부를 지역별 정의로 남겨둠

### **버전 3과 버전 5**

* 네임스페이스와 문자열 받아 해시 함수를 사용해 UUID 변환

* 입력 값이 같으면 UUID도 같음

* 해시 충돌을 막기 위해 별도의 네임스페이스 UUID 받음

* 버전 3 : 시간 + MD5해시

    * MD5 해시 알고리즘은 취약점 발견 후 사용하지 않는 추세지만 시스템 내부 고유 데이터 식별에는 문제가 없음

* 버전 5 : 시간 + SHA-1해시

### **버전 4**

* 오늘날 가장 많이 사용하는 UUID 버전

* 버전 4 : 시간 + 랜덤

    * 버전을 표기하는 4비트 제외한 122비트를 모두 무작위로 생성

## UUID 장점과 단점

* 장점
    * 사용 시 거의 중복이 되지 않을 고유키 생성 가능. UUID는 총 340,282,366,920,938,463,463,374,607,431,768,211,456 개의 키를 만들 수 있음.
    * DB와 각 언어에서 UUID 생성 기능 제공. 표준에 따라 UUID 생성하므로 고유성 충족 가능.
    * 키가 생성되는 규칙은 존재하지만 키값의 의미나 연속성 유추하기 어려워서 보안에 좋음.
* 단점
    * 16 바이트 이상을 사용하므로 크기가 큼.
    * 연속성이 없고 의미를 유추하기 어려워 PK와 인덱스로 사용 시 단점이 됨.

## UUID 사용 방법
* JAVA
    ```
    import java.util.UUID;

    public class Main{
        public static void main(String[] args) {
            UUID id = UUID.randomUUID();
        }
    }
    ```
<br>

* Node.js

    ```
    npm install uuid
    ```

    ```
    import { v4 as uuid4 } from 'uuid';
    uuidv4();
    ```

## 결론

DB에서 파일 관련 id를 UUID로 사용하는 것을 봐서 UUID가 무엇이고 왜 사용하는지 궁금해졌다.
이번 경우에는 AWS S3 에 파일 업로드하는 것 같은데, AWS에서 파일명이 겹치면 문제가 생긴다고 UUID로 id 값을 생성하고 해당 id 값으로 파일을 저장하고 있었다. 결국 중복값을 최대한 피하기 위해 사용하는 듯 했다.